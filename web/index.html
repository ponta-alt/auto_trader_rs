<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>auto_trader_rs – Dashboard</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 24px; background:#f5f5f7; }
        .card { background:#fff; border:1px solid #ddd; border-radius:10px; padding:16px; margin-bottom:16px; }
        table { width:100%; border-collapse: collapse; }
        th, td { padding:8px 10px; border-top:1px solid #eee; text-align:right; }
        th:first-child, td:first-child { text-align:left; }
    </style>
</head>
<body>
<h1>auto_trader_rs – ローカルダッシュボード</h1>

<div class="card" id="wallet">
    <h2>残高</h2>
    <div>読み込み中…</div>
</div>

<div class="card">
    <h2>保有株一覧</h2>
    <table id="positions">
        <thead>
        <tr>
            <th>銘柄名</th><th>コード</th><th>数量</th><th>平均単価</th><th>損益</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script defer>
    const num = v => (typeof v === 'number' ? v : Number(v ?? 0));
    const qtyOf = p => Math.round(Math.max(p.LeavesQty ?? 0, p.HoldQty ?? 0));

    async function load() {
        // 残高
        const w = await fetch('/api/wallet').then(r => r.json());
        document.getElementById('wallet').innerHTML = `
        <h2>残高</h2>
        <div>現物(国内)：${num(w.StockAccountWallet).toFixed(2)}</div>
        <div>信用(Acb)：${num(w.AcbStockAccountWallet).toFixed(2)}</div>
        <div>信用(AuBy)：${num(w.AuByStockAccountWallet).toFixed(2)}</div>
      `;

        // 建玉
        const ps = await fetch('/api/positions').then(r => r.json());
        const tbody = document.querySelector('#positions tbody');
        tbody.innerHTML = '';
        ps.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
          <td style="text-align:left;">${p.SymbolName ?? '-'}</td>
          <td>${p.Symbol ?? '-'}</td>
          <td>${qtyOf(p)}</td>
          <td>${num(p.Price).toFixed(2)}</td>
          <td>${num(p.ProfitLoss).toFixed(2)}</td>
        `;
            tbody.appendChild(tr);
        });
    }

    window.addEventListener('DOMContentLoaded', load);
</script>
</body>
</html>
